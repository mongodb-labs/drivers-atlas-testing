
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Installing and Running Locally &#8212; astrolabe  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Integration Guide" href="integration-guide.html" />
    <link rel="prev" title="Welcome to astrolabe’s documentation!" href="index.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="installing-and-running-locally">
<h1>Installing and Running Locally<a class="headerlink" href="#installing-and-running-locally" title="Permalink to this headline">¶</a></h1>
<p>Installing and running <code class="docutils literal notranslate"><span class="pre">astrolabe</span></code> is useful when writing integrations for new drivers (see <a class="reference internal" href="integration-guide.html#integration-guide"><span class="std std-ref">Integration Guide</span></a>)
and when debugging issues uncovered by testing. This document walks through the steps needed to install <code class="docutils literal notranslate"><span class="pre">astrolabe</span></code>
on your local machine and using it to run a planned maintenance test scenario.</p>
<section id="platform-support">
<h2>Platform Support<a class="headerlink" href="#platform-support" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">astrolabe</span></code> runs on Linux, OSX and Windows.</p>
<p>Running <code class="docutils literal notranslate"><span class="pre">astrolabe</span></code> requires Python 3.5 or later. To check the version of Python you are running, do:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ python --version
</pre></div>
</div>
</section>
<section id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">astrolabe</span></code> can be installed from sources using <code class="docutils literal notranslate"><span class="pre">pip</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ python -m pip install git+https://github.com/mongodb-labs/drivers-atlas-testing.git
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can use a <a class="reference external" href="https://virtualenv.pypa.io/en/latest/">virtualenv</a> to isolate your <code class="docutils literal notranslate"><span class="pre">astrolabe</span></code>
installation from other Python applications on your system. To do so, run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ python -m virtualenv my_virtualenv <span class="o">&amp;&amp;</span> <span class="nb">source</span> my_virtualenv/bin/activate
</pre></div>
</div>
<p>before running the command to install <code class="docutils literal notranslate"><span class="pre">astrolabe</span></code>. Note that the <code class="docutils literal notranslate"><span class="pre">bin</span></code> directory will be called <code class="docutils literal notranslate"><span class="pre">Scripts</span></code>
on Windows systems.</p>
</div>
<p>Once installed, check that your installation is working:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ astrolabe --version
</pre></div>
</div>
</section>
<section id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<p>Before you can start using <code class="docutils literal notranslate"><span class="pre">astrolabe</span></code>, you must configure it to give it access to the MongoDB Atlas API.</p>
<p>If you haven’t done so already, create a
<a class="reference external" href="https://docs.atlas.mongodb.com/organizations-projects">MongoDB Atlas Organization</a> (this can
only be done via the Atlas UI). Make a note of the name of the Atlas organization.</p>
<p>Depending on the test scenario being executed, you will need either one
or two sets of a <a class="reference external" href="https://docs.atlas.mongodb.com/configure-api-access/">Programmatic API Keys</a>: a regular
key for Atlas Organization you created with “Organization Owner” permissions,
and potentially a key with Atlas Global Operator permissions (hereafter
referred to as the “admin key”). The admin key generally must be created by
a Cloud team member and would typically be issued for the development environment
of Atlas (<a class="reference external" href="https://cloud-dev.mongodb.com">https://cloud-dev.mongodb.com</a>),
meaning the organization and projects must also be created in the development
environment.</p>
<p>Each API key consists of 2 parts - a public key and a private key.</p>
<p>To configure <code class="docutils literal notranslate"><span class="pre">astrolabe</span></code> to use production Atlas and specify only a regular
API key, declare the following variables:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">export</span> <span class="nv">ATLAS_ORGANIZATION_NAME</span><span class="o">=</span>&lt;Atlas Organization Name&gt;
$ <span class="nb">export</span> <span class="nv">ATLAS_API_USERNAME</span><span class="o">=</span>&lt;API Public Key&gt;
$ <span class="nb">export</span> <span class="nv">ATLAS_API_PASSWORD</span><span class="o">=</span>&lt;API Private Key&gt;
</pre></div>
</div>
<p>To configure <code class="docutils literal notranslate"><span class="pre">astrolabe</span></code> to use development Atlas and specify two sets of
API keys, declare the following variables:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">export</span> <span class="nv">ATLAS_ORGANIZATION_NAME</span><span class="o">=</span>&lt;Atlas Organization Name&gt;
$ <span class="nb">export</span> <span class="nv">ATLAS_API_USERNAME</span><span class="o">=</span>&lt;API Public Key&gt;
$ <span class="nb">export</span> <span class="nv">ATLAS_API_PASSWORD</span><span class="o">=</span>&lt;API Private Key&gt;
$ <span class="nb">export</span> <span class="nv">ATLAS_ADMIN_API_USERNAME</span><span class="o">=</span>&lt;Admin API Public Key&gt;
$ <span class="nb">export</span> <span class="nv">ATLAS_ADMIN_API_PASSWORD</span><span class="o">=</span>&lt;Admin API Private Key&gt;
$ <span class="nb">export</span> <span class="nv">ATLAS_API_BASE_URL</span><span class="o">=</span>https://cloud-dev.mongodb.com/api/atlas
</pre></div>
</div>
<p>Finally, use the <code class="docutils literal notranslate"><span class="pre">check-connection</span></code> command to confirm that <code class="docutils literal notranslate"><span class="pre">astrolabe</span></code> is able to connect to and authenticate
with the Atlas API:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ astrolabe check-connection
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you encounter an <code class="docutils literal notranslate"><span class="pre">AtlasAuthenticationError</span></code> when running <code class="docutils literal notranslate"><span class="pre">check-connection</span></code>, it means that
configuration was unsuccessful.</p>
</div>
</section>
<section id="exploring-the-api">
<h2>Exploring the API<a class="headerlink" href="#exploring-the-api" title="Permalink to this headline">¶</a></h2>
<p>With the Atlas API credentials now configured, you are ready to use <code class="docutils literal notranslate"><span class="pre">astrolabe</span></code>. Exploring
<code class="docutils literal notranslate"><span class="pre">astrolabe</span></code>’s capabilities is very easy due to its self-documenting command-line interface. To see a list of
available commands, run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ astrolabe --help
</pre></div>
</div>
<p>Say, for instance, that you would like to use <code class="docutils literal notranslate"><span class="pre">astrolabe</span></code> to create a cluster. Looking at the output of the
<code class="docutils literal notranslate"><span class="pre">astrolabe</span> <span class="pre">--help</span></code> command, you realize that the <code class="docutils literal notranslate"><span class="pre">clusters</span></code> command group probably has what you are looking for.
You can explore the usage of this command group by running:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ astrolabe clusters --help
</pre></div>
</div>
<p>Sure enough, the command group has the <code class="docutils literal notranslate"><span class="pre">create-dedicated</span></code> command that does what you want to do. Command usage can be
understood by employing a familiar pattern:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ astrolabe clusters create-dedicated --help
</pre></div>
</div>
</section>
<section id="running-atlas-planned-maintenance-tests">
<h2>Running Atlas Planned Maintenance Tests<a class="headerlink" href="#running-atlas-planned-maintenance-tests" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">spec-tests</span></code> command-group is used for Atlas Planned Maintenance (APM) tests. To run a single APM test, do:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ astrolabe spec-tests run-one &lt;path/to/test-file.yml&gt; -e &lt;path/to/workload-executor&gt; --project-name &lt;atlasProjectName&gt; --cluster-name-salt &lt;randomString&gt;
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;path/to/test-file.yml&gt;</span></code> is the absolute or relative path to a test scenario file in the
<a class="reference internal" href="spec-test-format.html#test-scenario-format-specification"><span class="std std-ref">Atlas Planned Maintenance Test Scenario Format</span></a>,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;path/to/workload-executor&gt;</span></code> is the absolute or relative path to the workload executor of the driver to be tested,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;atlasProjectName&gt;</span></code> is the name of the Atlas Project under which the test cluster used for the test will be created,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;randomString&gt;</span></code> is a string that is used as salt while generating the randomized character string that will be
used as the name of the test cluster.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If an Atlas Project of the specified name does not already exist, <code class="docutils literal notranslate"><span class="pre">astrolabe</span></code> will create one.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Cluster name generation uses the name of the test scenario file along with the value of
<code class="docutils literal notranslate"><span class="pre">--cluster-name-salt</span></code> to generate a randomized character string that is used as the name of the cluster created
for the purposes of running the test. A deterministic hashing algorithm is employed to generate cluster names so
using the same <code class="docutils literal notranslate"><span class="pre">--cluster-name-salt</span></code> value with a given test file will produce the same cluster name each time.</p>
</div>
<p>A common use-case when using <code class="docutils literal notranslate"><span class="pre">astrolabe</span></code> is to run a given test several times, in quick succession. This is
necessary during test failure debugging and testing workload executor implementations. By default, <code class="docutils literal notranslate"><span class="pre">astrolabe</span></code>
automatically deletes a cluster at the end of a test run (this helps keep cloud hosting costs low by minimizing Atlas
cluster uptime). This is quite inconvenient when the test needs to be run multiple times in succession as cluster
creation is very time consuming and can take up to 10 minutes. To ameliorate the situation, the <code class="docutils literal notranslate"><span class="pre">run-one</span></code> command
supports a <code class="docutils literal notranslate"><span class="pre">--no-delete</span></code> flag that prevents the deletion of the cluster at the end of a test run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ astrolabe spec-tests run-one ... --no-delete
</pre></div>
</div>
<p>Using this flag with a given test file and static <code class="docutils literal notranslate"><span class="pre">--cluster-name-salt</span></code> value helps significantly reduce waiting
times between successive test runs (you will still need to wait for the cluster to be reconfigured to the initial
configuration).</p>
<p><code class="docutils literal notranslate"><span class="pre">astrolabe</span></code> also provides the <code class="docutils literal notranslate"><span class="pre">--no-create</span></code> flag which makes it skip
cluster initialization if the cluster already exists. This flag may be used
to further speed up the test runs, but it can only be used for scenarios
where the cluster configuration does not change from the initial one
(otherwise the test would start with the wrong configuration). Using
<code class="docutils literal notranslate"><span class="pre">--no-delete</span></code> is recommended with <code class="docutils literal notranslate"><span class="pre">--no-create</span></code>, otherwise each run will
delete the cluster upon completion.</p>
</section>
<section id="debugging">
<h2>Debugging<a class="headerlink" href="#debugging" title="Permalink to this headline">¶</a></h2>
<p>Astrolabe comes with built-in logging functionality that can be customized using the <code class="docutils literal notranslate"><span class="pre">--log-level</span></code> option.
Supported logging levels, in decreasing order of verbosity are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">DEBUG</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">INFO</span></code> (the default)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">WARNING</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ERROR</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CRITICAL</span></code></p></li>
</ul>
<p>For example, to use the <code class="docutils literal notranslate"><span class="pre">DEBUG</span></code> logging level, do:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ astrolabe --log-level DEBUG &lt;command&gt; <span class="o">[</span>COMMAND OPTIONS<span class="o">]</span>
</pre></div>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">astrolabe</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Installing and Running Locally</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#platform-support">Platform Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configuration">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#exploring-the-api">Exploring the API</a></li>
<li class="toctree-l2"><a class="reference internal" href="#running-atlas-planned-maintenance-tests">Running Atlas Planned Maintenance Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="#debugging">Debugging</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="integration-guide.html">Integration Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="spec-workload-executor.html">Workload Executor Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="spec-test-format.html">Atlas Planned Maintenance Test Scenario Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="technical-design.html">Technical Design: Testing Drivers Against Atlas Planned Maintenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">Frequently Asked Questions</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="index.html" title="previous chapter">Welcome to astrolabe’s documentation!</a></li>
      <li>Next: <a href="integration-guide.html" title="next chapter">Integration Guide</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, MongoDB, Inc..
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/installing-running-locally.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>