initialConfiguration:
  clusterConfiguration:
    clusterType: REPLICASET
    providerSettings:
      providerName: AWS
      instanceSizeName: M10
    replicationSpecs:
      -
        id: '111111111111111111111111'
        numShards: 1
        regionsConfig:
          US_WEST_1:
            electableNodes: 3
            priority: 7
            readOnlyNodes: 0
  processArgs: {}

operations:
  - assertPrimaryRegion:
      region: US_WEST_1
  
  -
    setClusterConfiguration:
      clusterConfiguration:
        clusterType: REPLICASET
        providerSettings:
          providerName: AWS
          instanceSizeName: M10
        replicationSpecs:
          -
            id: '111111111111111111111111'
            numShards: 1
            regionsConfig:
              US_WEST_1:
                electableNodes: 2
                priority: 6
                readOnlyNodes: 0
              US_EAST_1:
                electableNodes: 1
                priority: 7
                readOnlyNodes: 0
      processArgs: {}

  - assertPrimaryRegion:
      region: US_EAST_1
      timeout: 60
  

driverWorkload:
  description: "Find"

  schemaVersion: "1.0"

  createEntities:
    - client:
        id: &client0 client0
        uriOptions:
          retryReads: true
        storeEventsAsEntities:
          CommandStartedEvent: command
          CommandSucceededEvent: command
          CommandFailedEvent: command
          PoolCreatedEvent: connection
          PoolReadyEvent: connection
          PoolClearedEvent: connection
          PoolClosedEvent: connection
          ConnectionCreatedEvent: connection
          ConnectionReadyEvent: connection
          ConnectionClosedEvent: connection
          ConnectionCheckOutStartedEvent: connection
          ConnectionCheckOutFailedEvent: connection
          ConnectionCheckedOutEvent: connection
          ConnectionCheckedInEvent: connection
    - database:
        id: &database0 database0
        client: *client0
        databaseName: &database0Name dat
    - collection:
        id: &collection0 collection0
        database: *database0
        collectionName: &collection0Name dat

  initialData:
    - collectionName: *collection0Name
      databaseName: *database0Name
      documents:
        - {_id: 1, x: 11}
        - {_id: 2, x: 22}
        - {_id: 3, x: 33}

  tests:
    - description: "Find one"
      operations:
        - name: loop
          object: testRunner
          arguments:
            storeErrorsAsEntity: errors
            storeIterationsAsEntity: iterations
            operations:
              - name: find
                object: *collection0
                arguments:
                  filter: { _id: { $gt: 1 }}
                  sort: { _id: 1 }
                expectResult:
                  -
                    _id: 2
                    x: 22
                  -
                    _id: 3
                    x: 33
